"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[4180],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return d}});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},m=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,l=e.originalType,p=e.parentName,m=r(e,["components","mdxType","originalType","parentName"]),u=s(t),d=i,c=u["".concat(p,".").concat(d)]||u[d]||k[d]||l;return t?a.createElement(c,o(o({ref:n},m),{},{components:t})):a.createElement(c,o({ref:n},m))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var l=t.length,o=new Array(l);o[0]=u;var r={};for(var p in n)hasOwnProperty.call(n,p)&&(r[p]=n[p]);r.originalType=e,r.mdxType="string"==typeof e?e:i,o[1]=r;for(var s=2;s<l;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},85162:function(e,n,t){t.d(n,{Z:function(){return o}});var a=t(67294),i=t(34334),l="tabItem_Ymn6";function o(e){var n=e.children,t=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(l,o),hidden:t},n)}},65488:function(e,n,t){t.d(n,{Z:function(){return d}});var a=t(83117),i=t(67294),l=t(34334),o=t(72389),r=t(67392),p=t(7094),s=t(12466),m="tabList__CuJ",k="tabItem_LNqP";function u(e){var n,t,o=e.lazy,u=e.block,d=e.defaultValue,c=e.values,N=e.groupId,g=e.className,b=i.Children.map(e.children,(function(e){if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),v=null!=c?c:b.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),h=(0,r.l)(v,(function(e,n){return e.value===n.value}));if(h.length>0)throw new Error('Docusaurus error: Duplicate values "'+h.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var f=null===d?d:null!=(n=null!=d?d:null==(t=b.find((function(e){return e.props.default})))?void 0:t.props.value)?n:b[0].props.value;if(null!==f&&!v.some((function(e){return e.value===f})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+f+'" but none of its children has the corresponding value. Available values are: '+v.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var y=(0,p.U)(),T=y.tabGroupChoices,I=y.setTabGroupChoices,C=(0,i.useState)(f),O=C[0],B=C[1],E=[],A=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=N){var S=T[N];null!=S&&S!==O&&v.some((function(e){return e.value===S}))&&B(S)}var D=function(e){var n=e.currentTarget,t=E.indexOf(n),a=v[t].value;a!==O&&(A(n),B(a),null!=N&&I(N,String(a)))},w=function(e){var n,t=null;switch(e.key){case"ArrowRight":var a,i=E.indexOf(e.currentTarget)+1;t=null!=(a=E[i])?a:E[0];break;case"ArrowLeft":var l,o=E.indexOf(e.currentTarget)-1;t=null!=(l=E[o])?l:E[E.length-1]}null==(n=t)||n.focus()};return i.createElement("div",{className:(0,l.Z)("tabs-container",m)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":u},g)},v.map((function(e){var n=e.value,t=e.label,o=e.attributes;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:O===n?0:-1,"aria-selected":O===n,key:n,ref:function(e){return E.push(e)},onKeyDown:w,onFocus:D,onClick:D},o,{className:(0,l.Z)("tabs__item",k,null==o?void 0:o.className,{"tabs__item--active":O===n})}),null!=t?t:n)}))),o?(0,i.cloneElement)(b.filter((function(e){return e.props.value===O}))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},b.map((function(e,n){return(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==O})}))))}function d(e){var n=(0,o.Z)();return i.createElement(u,(0,a.Z)({key:String(n)},e))}},42591:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return m},default:function(){return N},frontMatter:function(){return s},metadata:function(){return k},toc:function(){return d}});var a=t(83117),i=t(80102),l=(t(67294),t(3905)),o=t(65488),r=t(85162),p=["components"],s={sidebar_position:3,title:"Save\u6307\u4ee4"},m=void 0,k={unversionedId:"jimmer-sql/mutation/save-command",id:"jimmer-sql/mutation/save-command",title:"Save\u6307\u4ee4",description:"\u5982\u679c\u8bf4GraphQL\u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u52a8\u6001\u6811\u8f93\u51fa\u624b\u6bb5\uff0c\u90a3\u4e48save\u6307\u4ee4\u5c31\u662f\u4e00\u4e2a\u52a8\u6001\u6811\u8f93\u5165\u624b\u6bb5\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/jimmer-sql/mutation/save-command.mdx",sourceDirName:"jimmer-sql/mutation",slug:"/jimmer-sql/mutation/save-command",permalink:"/jimmer/zh/docs/jimmer-sql/mutation/save-command",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer/tree/main/doc/docs/jimmer-sql/mutation/save-command.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Save\u6307\u4ee4"},sidebar:"tutorialSidebar",previous:{title:"Delete\u8bed\u53e5",permalink:"/jimmer/zh/docs/jimmer-sql/mutation/delete-statement"},next:{title:"\u751f\u4ea7\u9759\u6001\u7c7b\u578b",permalink:"/jimmer/zh/docs/jimmer-sql/mutation/static"}},u={},d=[{value:"\u672c\u6587\u8ba8\u8bba\u8303\u56f4",id:"\u672c\u6587\u8ba8\u8bba\u8303\u56f4",level:2},{value:"\u4fdd\u5b58\u6a21\u5f0f",id:"\u4fdd\u5b58\u6a21\u5f0f",level:2},{value:"upsert",id:"upsert",level:3},{value:"insert-only",id:"insert-only",level:3},{value:"udpate-only",id:"udpate-only",level:3},{value:"\u4e1a\u52a1\u4e3b\u952e",id:"\u4e1a\u52a1\u4e3b\u952e",level:2},{value:"\u9759\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e",id:"\u9759\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e",level:3},{value:"\u4fdd\u5b58\u65e0id\u5bf9\u8c61",id:"\u4fdd\u5b58\u65e0id\u5bf9\u8c61",level:3},{value:"\u52a8\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e",id:"\u52a8\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e",level:3},{value:"\u6b8b\u7f3a\u5bf9\u8c61",id:"\u6b8b\u7f3a\u5bf9\u8c61",level:2},{value:"\u4e50\u89c2\u9501",id:"\u4e50\u89c2\u9501",level:2},{value:"\u4fdd\u5b58\u5173\u8054",id:"\u4fdd\u5b58\u5173\u8054",level:2},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"\u88ab\u7236\u5bf9\u8c61\u629b\u5f03",id:"\u88ab\u7236\u5bf9\u8c61\u629b\u5f03",level:3},{value:"\u4fdd\u5b58\u5173\u8054\u548c\u5173\u8054\u5bf9\u8c61",id:"\u4fdd\u5b58\u5173\u8054\u548c\u5173\u8054\u5bf9\u8c61",level:2}],c={toc:d};function N(e){var n=e.components,s=(0,i.Z)(e,p);return(0,l.kt)("wrapper",(0,a.Z)({},c,s,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u5982\u679c\u8bf4GraphQL\u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u52a8\u6001\u6811\u8f93\u51fa\u624b\u6bb5\uff0c\u90a3\u4e48save\u6307\u4ee4\u5c31\u662f\u4e00\u4e2a\u52a8\u6001\u6811\u8f93\u5165\u624b\u6bb5\u3002")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"save",src:t(46607).Z,width:"1473",height:"1036"})),(0,l.kt)("p",null,"Save\u547d\u4ee4\u7528\u4e8e\u4fdd\u5b58\u4efb\u610f\u5e7f\u5ea6\u4efb\u610f\u6df1\u5ea6\u5bf9\u8c61\u6811\u3002"),(0,l.kt)("p",null,"\u5927\u90e8\u5206ORM\u6846\u67b6\u8ba9\u5f00\u53d1\u4eba\u5458\u5728\u5b9e\u4f53\u7c7b\u578b\u4e0a\u58f0\u660e\u9759\u6001\u7684\u7ea7\u8054\u4fdd\u5b58\u64cd\u4f5c\u914d\u7f6e\uff0c\u4ee5\u6b64\u4e3a\u6307\u5bfc\u4fdd\u5b58\u591a\u4e2a\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"jimmer-sql\u4f7f\u7528\u4e86\u53e6\u5916\u4e00\u79cd\u622a\u7136\u4e0d\u540c\u7684\u65b9\u5f0f\uff0c\u5229\u7528jimmer-core\u4e0d\u53ef\u53d8\u5bf9\u8c61\u672c\u8eab\u7684\u52a8\u6001\u6027\uff0c\u6765\u63cf\u8ff0\u4efb\u610f\u590d\u6742\u5ea6\u7684\u88ab\u4fdd\u5b58\u7684\u5bf9\u8c61\u6811\uff0c\u4f8b\u5982"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u6b8b\u7f3a\u7684\u5bf9\u8c61"),(0,l.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u5b8c\u6574\u7684\u5bf9\u8c61"),(0,l.kt)("li",{parentName:"ul"},"\u4e00\u9897\u6bd4\u8f83\u6d45\u7684\u5bf9\u8c61\u6811"),(0,l.kt)("li",{parentName:"ul"},"\u4e00\u9897\u6bd4\u8f83\u6df1\u7684\u5bf9\u8c61\u6811")),(0,l.kt)("p",null,"\u4ee5\u4e0a\u8fd9\u4e9b\u60c5\u51b5\uff0c\u90fd\u53ef\u4ee5\u88abjimmer-core\u4e0d\u53ef\u53d8\u5bf9\u8c61\u7684\u52a8\u6001\u6027\u8f7b\u677e\u5730\u8868\u8fbe\u3002"),(0,l.kt)("p",null,"\u6240\u4ee5\uff0cjimmer-sql\u4e0d\u9700\u5bf9\u5b9e\u4f53\u7c7b\u578b\u5143\u6570\u636e\u8fdb\u884c\u9759\u6001\u7684\u7ea7\u8054\u4fdd\u5b58\u914d\u7f6e\uff0c\u6240\u6709\u4fe1\u606f\u90fd\u901a\u8fc7\u88ab\u4fdd\u5b58\u5bf9\u8c61\u672c\u8eab\u52a8\u6001\u5730\u8868\u8fbe\u3002"),(0,l.kt)("h2",{id:"\u672c\u6587\u8ba8\u8bba\u8303\u56f4"},"\u672c\u6587\u8ba8\u8bba\u8303\u56f4"),(0,l.kt)("p",null,"Jimmer\u652f\u6301",(0,l.kt)("a",{parentName:"p",href:"../advanced/trigger"},"\u89e6\u53d1\u5668"),"\uff0c\u5176\u4e2d\u5206\u4e3aBinLog\u89e6\u53d1\u5668\u548cTransaction\u89e6\u53d1\u5668\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u4f7f\u7528Transaction\u89e6\u53d1\u5668\uff0c\u5c06\u4f1a\u5bfc\u81f4Jimmer\u4fee\u6539\u64cd\u4f5c\u751f\u6210\u66f4\u591a\u66f4\u5b8c\u6574\u7684\u67e5\u8be2\u8bed\u53e5\u4ee5\u6a21\u62df\u89e6\u53d1\u5668\u3002"),(0,l.kt)("p",null,"\u672c\u6587\u6240\u8ba8\u8bba\u4e86\u82e5\u5e72\u573a\u666f\uff0c\u5bf9\u6bcf\u79cd\u573a\u666f\u90fd\u4f1a\u8ba8\u8bba\u751f\u6210\u7684SQL\uff0c\u90fd\u662f\u4ee5\u672a\u4f7f\u7528Transaction\u89e6\u53d1\u5668\u4f5c\u4e3a\u524d\u63d0\u4e0b\u7684\u3002"),(0,l.kt)("h2",{id:"\u4fdd\u5b58\u6a21\u5f0f"},"\u4fdd\u5b58\u6a21\u5f0f"),(0,l.kt)("h3",{id:"upsert"},"upsert"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0csave\u6307\u4ee4\u6267\u884c\u7684\u662fupsert\u64cd\u4f5c\uff0c\u5373update\u6216insert\u3002\u4f8b\u5982"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<Book> result = sqlClient\n    .getEntities()\n    .save(\n        BookDraft.$.produce(book -> {\n            book\n                .setId(1L)\n                .setName("SpringBoot in Action")\n                .setEdition(1)\n                .setPrice(new BigDecimal("44.99"));\n        })\n    );\nSystem.out.println("Affected row count: " + result.getTotalAffectedRowCount());\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient\n    .entities\n    .save(\n        new(Book::class).by { \n            id = 1L\n            name = "SpringBoot in Action"\n            edition = 1\n            price = BigDecimal("44.99")\n        }\n    )\nprintln("Affected row count: " + result.totalAffectedRowCount)\n')))),(0,l.kt)("p",null,"\u5047\u8bbe\u6307\u5b9a\u7684\u5bf9\u8c61\u5728\u6570\u636e\u5e93\u5e93\u4e2d\u4e0d\u5b58\u5728\uff0c\u5219\u751f\u6210\u4e24\u6761SQL"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select \n    tb_1_.ID, \n    tb_1_.NAME, \n    tb_1_.EDITION \nfrom BOOK as tb_1_ \nwhere tb_1_.ID = ?\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK(ID, NAME, EDITION, PRICE) \nvalues(?, ?, ?, ?);\n")))),(0,l.kt)("p",null,"\u7b2c\u4e00\u53e5SQL\u67e5\u8be2\u6307\u5b9a\u5bf9\u8c61\u662f\u5426\u5728\u6570\u636e\u5e93\u4e2d\u5b58\u5728\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u7b2c\u4e8c\u6761SQL\u662finsert\u8bed\u53e5\uff1b\u5426\u5219\uff0c\u7b2c\u4e8c\u6761SQL\u662fupdate\u8bed\u53e5\u3002"),(0,l.kt)("a",{name:"why_select_name_and_edition"},"\u81f3\u4e8e`NAME`\u548c`EDITION`\u51fa\u73b0\u5728\u67e5\u8be2\u8bed\u53e5\u4e2d\u7684\u539f\u56e0\uff0c\u540e\u6587\u4f1a\u8ba8\u8bba\uff0c\u8fd9\u91cc\u8bf7\u5148\u5ffd\u7565\u5b83\u4eec\u3002"),(0,l.kt)("h3",{id:"insert-only"},"insert-only"),(0,l.kt)("p",null,"\u524d\u9762\u7684\u6848\u4f8b\u4e2d\uff0c\u901a\u8fc7\u4e00\u6761\u67e5\u8be2\u6765\u5224\u65ad",(0,l.kt)("inlineCode",{parentName:"p"},"save"),"\u64cd\u4f5c\u5e94\u8be5\u89e3\u91ca\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"insert"),"\u8fd8\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"update"),"\u3002\u8fd9\u662fsave\u6307\u4ee4\u7684\u9ed8\u8ba4\u884c\u4e3a\u3002"),(0,l.kt)("p",null,"\u8fd9\u79cd\u884c\u4e3a\u867d\u7136\u7528\u8d77\u6765\u65b9\u4fbf\uff0c\u4f46\u4f1a\u5f15\u5165\u4e00\u6761\u989d\u5916\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"select"),"\u8bed\u53e5\uff0c\u5bf9\u6027\u80fd\u6709\u5f71\u54cd\u3002"),(0,l.kt)("p",null,"\u6709\u65f6\uff0c\u5f00\u53d1\u4eba\u5458\u6e05\u695a\u81ea\u5df1\u8981\u6267\u884c\u7684\u64cd\u4f5c\u5c31\u662finsert\uff0c\u4e3a\u4e86\u6027\u80fd\uff0c\u4e0d\u9700\u8981\u81ea\u52a8\u5224\u65ad\u3002"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<Book> result = sqlClient\n    .getEntities()\n    .saveCommand(\n        BookDraft.$.produce(book -> {\n            book\n                .setId(100L)\n                .setName("SpringBoot in Action")\n                .setEdition(1)\n                .setPrice(new BigDecimal("44.99"));\n        })\n    )\n    .configure(it -> \n        // highlight-next-line\n        it.setMode(SaveMode.INSERT_ONLY)\n    )\n    .execute();\nSystem.out.println("Affected row count: " + result.getTotalAffectedRowCount());\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient\n    .entities\n    .save(\n        new(Book::class).by {\n            id = 100L\n            name = "SpringBoot in Action"\n            edition = 1\n            price = BigDecimal("44.99")\n        }\n    ) {\n        // highlight-next-line\n        setMode(SaveMode.INSERT_ONLY)\n    }\nprintln("Affected row count: " + result.totalAffectedRowCount)\n')))),(0,l.kt)("p",null,"\u8fd9\u91cc\uff0c\u6211\u4eec\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"setMode(SaveMode.INSERT_ONLY)"),"\u628asave\u6307\u4ee4\u914d\u7f6e\u6210",(0,l.kt)("inlineCode",{parentName:"p"},"insert-only"),"\u6a21\u5f0f\uff0c\u6700\u7ec8\uff0c\u53ea\u4f1a\u751f\u6210\u4e00\u6761\u63d2\u5165\u6570\u636e\u7684SQL"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK(ID, NAME, EDITION, PRICE) \n    values(?, ?, ?, ?);\n")),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient.getEntities().save(someObj);\n")),(0,l.kt)("p",{parentName:"admonition"},"\u548c"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient.getEntities().saveCommand(someObj).execute();\n")),(0,l.kt)("p",{parentName:"admonition"},"\u5b8c\u5168\u7b49\u4ef7\u3002"),(0,l.kt)("p",{parentName:"admonition"},"\u524d\u8005\u662f\u7b80\u6d01\u7684\u5199\u6cd5\uff0c\u540e\u8005\u662f\u53ef\u4ee5\u914d\u7f6e\u7684\u5199\u6cd5\u3002")),(0,l.kt)("h3",{id:"udpate-only"},"udpate-only"),(0,l.kt)("p",null,"\u540c\u7406\uff0c\u5982\u679c\u5f00\u53d1\u4eba\u5458\u660e\u786e\u81ea\u5df1\u8981\u6267\u884c\u7684\u64cd\u4f5c\u4e00\u5b9a\u662fupdate\u800c\u975einsert\uff0c\u53ef\u4ee5\u4f7f\u7528update-only\u6a21\u5f0f"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<Book> result = sqlClient\n    .getEntities()\n    .saveCommand(\n        BookDraft.$.produce(book -> {\n            book\n                .setId(1L)\n                .setName("SpringBoot in Action")\n                .setEdition(1)\n                .setPrice(new BigDecimal("44.99"));\n        })\n    )\n    .configure(it -> \n        // highlight-next-line\n        it.setMode(SaveMode.UPDATE_ONLY)\n    )\n    .execute();\nSystem.out.println("Affected row count: " + result.getTotalAffectedRowCount());\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient\n    .entities\n    .save(\n        new(Book::class).by {\n            id = 1L\n            name = "SpringBoot in Action"\n            edition = 1\n            price = BigDecimal("44.99")\n        }\n    ) {\n        // highlight-next-line\n        setMode(SaveMode.UPDATE_ONLY)\n    }\nprintln("Affected row count: " + result.totalAffectedRowCount)\n')))),(0,l.kt)("p",null,"\u6700\u7ec8\u751f\u6210\u7684SQL\u53ea\u4f1a\u6709\u4e00\u6761"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK \nset \n    NAME = ?, \n    EDITION = ?, \n    PRICE = ? \nwhere \n    ID = ?\n")),(0,l.kt)("h2",{id:"\u4e1a\u52a1\u4e3b\u952e"},"\u4e1a\u52a1\u4e3b\u952e"),(0,l.kt)("h3",{id:"\u9759\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e"},"\u9759\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e"),(0,l.kt)("p",null,"\u5728",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#key"},"\u6620\u5c04/@key"),"\u5904\uff0c\u6211\u4eec\u66fe\u7ecf\u8bb2\u89e3\u4e86@Key\u6ce8\u89e3\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"@Id: \u6280\u672f\u578b\u4e3b\u952e\uff0c\u5f80\u5f80\u5b58\u50a8\u4e00\u4e9b\u548c\u5b9e\u9645\u4e1a\u52a1\u65e0\u5173\u7684\u552f\u4e00\u6027\u6570\u636e\uff0c\u6bd4\u5982\u81ea\u52a8\u7f16\u53f7\uff0c\u5e8f\u5217\u503c\uff0cUUID\uff0c\u96ea\u82b1id\u3002\u4f46\u5b83\u8db3\u591f\u7b80\u5355\uff0c\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u5730\u7b80\u5316\u8868\u4e4b\u95f4\u7684\u8fde\u63a5\uff0c\u4f18\u5316\u6027\u80fd\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"@Key: \u4e1a\u52a1\u6027\u4e3b\u952e\uff0c\u5b58\u50a8\u548c\u5b9e\u9645\u4e1a\u52a1\u76f8\u5173\u7684\u552f\u4e00\u6027\u6570\u636e\uff0c\u800c\u4e14\u5f80\u5f80\u591a\u5217\u8054\u5408\u8054\u7528\u3002\u4f46\u5b83\u76f8\u5bf9\u590d\u6742\uff0c\u5e76\u4e0d\u76f4\u63a5\u53c2\u4e0e\u8868\u4e4b\u95f4\u7684\u5173\u8054\u64cd\u4f5c\u3002"))),(0,l.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u7c7b\u578b\u6307\u5b9a\u4e1a\u52a1\u4e3b\u952e"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    long id();\n\n    // highlight-next-line\n    @Key\n    String name();\n\n    // highlight-next-line\n    @Key\n    int edition();\n\n    ...Omit other code...\n}\n"))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity\ninterface Book {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    val id: Long\n\n    // highlight-next-line\n    @Key\n    val name: String\n\n    // highlight-next-line\n    @Key\n    val edition: Int\n\n    ...Omit other code...\n}\n")))),(0,l.kt)("p",null,"\u524d\u9762\u63d0\u51fa\u4e86\u4e00\u4e2a",(0,l.kt)("a",{parentName:"p",href:"#why_select_name_and_edition"},"\u95ee\u9898"),"\uff0c\u8fd9\u91cc\u53ef\u4ee5\u56de\u7b54\u4e4b\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u4e3a\u5b9e\u4f53\u63a5\u53e3\u914d\u7f6e\u4e86\u4e1a\u52a1\u4e3b\u952e\uff0c\u90a3\u4e48save\u6307\u4ee4\u5c31\u53ef\u4ee5\u63a5\u53d7\u6ca1\u6709id\u7684\u5bf9\u8c61\uff0c\u5373\uff0cid\u5c5e\u6027\u5904\u4e8eunloaded\u72b6\u6001\u7684\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u91c7\u7528upsert\u6a21\u5f0f\u7684save\u547d\u4ee4\u800c\u8a00"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u88ab\u4fdd\u5b58\u5bf9\u8c61\u7684id\u88ab\u6307\u5b9a\uff0c\u90a3\u4e48save\u547d\u4ee4\u6309\u7167id\u5c5e\u6027\u6765\u67e5\u8be2\u88ab\u4fdd\u5b58\u5bf9\u8c61\u662f\u5426\u5728\u6570\u636e\u5e93\u4e2d\u5b58\u5728\uff0c\u4ece\u800c\u51b3\u5b9a\u540e\u7eed\u64cd\u4f5c\u662finsert\u8fd8\u662fupdate\u3002\u5c31\u5982\u540c\u6211\u4eec\u4e4b\u524d\u793a\u8303\u7684\u90a3\u6837\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u88ab\u4fdd\u5b58\u5bf9\u8c61\u7684id\u6ca1\u6709\u88ab\u6307\u5b9a\uff0c\u5219\u5224\u65ad\u662f\u5426\u914d\u7f6e\u4e86\u4e1a\u52a1\u4e3b\u952e"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u914d\u7f6e\u4e86\u4e1a\u52a1\u4e3b\u952e\uff0c\u6309\u7167\u4e1a\u52a1\u4e3b\u952e\u7684\u5c5e\u6027\u6765\u67e5\u8be2\u88ab\u4fdd\u5b58\u5bf9\u8c61\u662f\u5426\u5728\u6570\u636e\u5e93\u4e2d\u5b58\u5728\uff0c\u4ece\u800c\u51b3\u5b9a\u540e\u7eed\u64cd\u4f5c\u662finsert\u8fd8\u662fupdate\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5426\u5219\uff0c\u629b\u51fa\u5f02\u5e38\u3002")))),(0,l.kt)("h3",{id:"\u4fdd\u5b58\u65e0id\u5bf9\u8c61"},"\u4fdd\u5b58\u65e0id\u5bf9\u8c61"),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4fdd\u5b58\u65e0id\u7684\u5bf9\u8c61\u7684\u4f8b\u5b50"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<Book> result = sqlClient\n    .getEntities()\n    .save(\n        BookDraft.$.produce(book -> {\n            book\n                // No id here\n                .setName("SpringBoot in Action")\n                .setEdition(1)\n                .setPrice(new BigDecimal("44.99"));\n        })\n    );\nSystem.out.println(\n    "Original entity: " + result.getOriginalEntity()\n);\nSystem.out.println(\n    "Modified entity: " + result.getModifiedEntity()\n);\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient\n    .entities\n    .save(\n        new(Book::class).by {\n            // No id here\n            name = "SpringBoot in Action"\n            edition = 1\n            price = BigDecimal("44.99")\n        }\n    )\nprintln(\n    "Original entity: " + result.originalEntity\n)\nprintln(\n    "Modified entity: " + result.modifiedEntity\n)\n')))),(0,l.kt)("p",null,"\u88ab\u4fdd\u5b58\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\u65e0id\uff0c\u6240\u4ee5\u6839\u636e\u4e1a\u52a1\u4e3b\u952e",(0,l.kt)("inlineCode",{parentName:"p"},"name"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"edition"),"\u6765\u67e5\u8be2\u88ab\u4fdd\u5b58\u5bf9\u8c61\u662f\u5426\u5728\u6570\u636e\u5e93\u4e2d\u5b58\u5728\u3002"),(0,l.kt)("p",null,"\u5047\u8bbe\u4e0a\u9762\u7684\u4ee3\u7801\u6700\u7ec8\u5bfc\u81f4\u4e86insert\u64cd\u4f5c\uff0c\u751f\u6210\u7684\u4e24\u6761SQL\u5982\u4e0b"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select \n    tb_1_.ID, \n    tb_1_.NAME, \n    tb_1_.EDITION \nfrom BOOK as tb_1_ \nwhere\n/* highlight-start */ \n    tb_1_.NAME = ? \nand \n    tb_1_.EDITION = ?\n/* highlight-end */\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK(ID, NAME, EDITION, PRICE) \nvalues(?, ?, ?, ?)\n")))),(0,l.kt)("p",null,"\u8981\u63d2\u5165\u6ca1\u6709id\u7684\u5bf9\u8c61\uff0c\u5c31\u5fc5\u987b\u4e3aid\u5c5e\u6027\u914d\u7f6e",(0,l.kt)("inlineCode",{parentName:"p"},"@GeneratedValue"),"\uff0c\u4ee5\u65b9\u4fbfjimmer-sql\u4e3a\u5176\u81ea\u52a8\u751f\u6210id\u3002"),(0,l.kt)("p",null,"\u6700\u7ec8\u6211\u4eec\u53ef\u4ee5\u83b7\u53d6\u88ab\u81ea\u52a8\u5206\u914d\u7684id\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u6253\u5370\u7ed3\u679c\u5982\u4e0b\uff08\u539f\u8f93\u51fa\u662f\u7d27\u51d1\u7684\uff0c\u4e3a\u4e86\u65b9\u4fbf\u9605\u8bfb\uff0c\u8fd9\u91cc\u8fdb\u884c\u4e86\u683c\u5f0f\u5316\uff09:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'Original entity: {\n    "name":"SpringBoot in Action",\n    "edition":1,\n    "price":44.99\n}\nModified entity: {\n    "id":"79c47b20-e23b-47db-b49d-c485e6339ef0",\n    "name":"SpringBoot in Action",\n    "edition":1,\n    "price":44.99\n}\n')),(0,l.kt)("p",null,"save\u6307\u4ee4\u8fd4\u56de\u7c7b\u578b",(0,l.kt)("inlineCode",{parentName:"p"},"SimpleSaveResult<E>"),"\u5305\u542b\u4e24\u4e2a\u53ea\u8bfb\u5c5e\u6027"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"originalEntity"),": \u7528\u6237\u4f7f\u7528\u4fdd\u5b58\u547d\u4ee4\u65f6\u4f20\u5165\u7684\u5bf9\u8c61\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"modifiedEntity"),": \u4fdd\u5b58\u547d\u4ee4\u6267\u884c\u540e\uff0c\u88ab\u4fdd\u5b58\u5bf9\u8c61\u7684\u6700\u65b0\u72b6\u6001\u3002"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u4fdd\u5b58\u8fc7\u7a0b\u6d89\u53ca\u4e00\u4e9b\u81ea\u52a8\u7684\u5bf9\u8c61\u53d8\u66f4\uff0c\u6bd4\u5982\uff1aid\u81ea\u52a8\u5206\u914d\uff0c\u4e50\u89c2\u9501\u7248\u672c\u53f7\u81ea\u589e\uff0c\u90a3\u4e48jimmer-sql\u4f1a\u8ba9",(0,l.kt)("inlineCode",{parentName:"p"},"modifiedEntity"),"\u6307\u5411\u4e00\u4e2a\u65b0\u5bf9\u8c61\u3002\u7528\u6237\u53ef\u4ee5\u53d6\u5230\u6570\u636e\u7684\u6700\u65b0\u72b6\u6001\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5426\u5219\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"modifiedEntity"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"originalEntity"),"\u6307\u5411\u540c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5171\u4eab\u7528\u6237\u4f20\u9012\u7684\u65e7\u5bf9\u8c61\u3002"))))),(0,l.kt)("h3",{id:"\u52a8\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e"},"\u52a8\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e"),(0,l.kt)("p",null,"\u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u6ce8\u89e3",(0,l.kt)("inlineCode",{parentName:"p"},"@Key"),"\u9759\u6001\u5730\u914d\u7f6e\u4e1a\u52a1\u4e3b\u952e\u3002\u5176\u5b9e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4e3asave\u547d\u4ee4\u52a8\u6001\u5730\u8bbe\u7f6e\u4e1a\u52a1\u4e3b\u952e\u3002"),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"\u5982\u679c\u4f60\u7684\u9879\u76ee\u9700\u8981\u9488\u5bf9\u4e0d\u540c\u7684\u4e1a\u52a1\u573a\u666f\u4e3a\u540c\u4e00\u5b9e\u4f53\u7c7b\u578b\u5b9a\u4e49\u4e0d\u540c\u7684\u4e1a\u52a1\u4e3b\u952e\uff0c\u8fd9\u5c06\u975e\u5e38\u6709\u7528\u3002")),(0,l.kt)("p",null,"\u52a8\u6001\u5b9a\u4e49\u4e1a\u52a1\u4e3b\u952e\u7684\u65b9\u6cd5"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<Book> result = sqlClient\n    .getEntities()\n    .saveCommand(\n        BookDraft.$.produce(book -> {\n            book\n                    .setName("SpringBoot in Action")\n                    .setEdition(1)\n                    .setPrice(new BigDecimal("44.99"));\n        })\n    )\n    .configure(\n        // highlight-next-line\n        it -> it.setKeyProps(BookTable.class, keyProps -> {\n            keyProps\n                    .add(BookProps.NAME)\n                    .add(BookProps.EDITION);\n        })\n    )\n    .execute();\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient\n    .entities\n    .save(\n        new(Book::class).by {\n            // No id here\n            name = "SpringBoot in Action"\n            edition = 1\n            price = BigDecimal("44.99")\n        }\n    ) {\n        // highlight-next-line\n        setKeyProps(Book::name, Book::price)\n    }\nprintln(result)\n')))),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u5982\u679c\u65e2\u4e3asave\u6307\u4ee4\u914d\u7f6e\u4e86\u52a8\u6001\u4e1a\u52a1\u4e3b\u952e\uff0c\u53c8\u4e3a\u5b9e\u4f53\u63a5\u53e3\u914d\u7f6e\u4e86\u9759\u6001\u4e1a\u52a1\u4e3b\u952e\uff0c\u5219\u52a8\u6001\u914d\u7f6e\u4f18\u5148\u3002")),(0,l.kt)("h2",{id:"\u6b8b\u7f3a\u5bf9\u8c61"},"\u6b8b\u7f3a\u5bf9\u8c61"),(0,l.kt)("p",null,"jimmer-core\u4e0d\u53ef\u53d8\u5bf9\u8c61\u7684\u52a8\u6001\u6027\u4f1a\u5bfc\u81f4\u6b8b\u7f3a\u5bf9\u8c61\uff0c\u5373\uff0c\u5177\u5907\u672a\u6307\u5b9a\u5c5e\u6027\u7684\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u6b8b\u7f3a\u5bf9\u8c61\u5bf9save\u6307\u4ee4\u800c\u8a00\u5f88\u91cd\u8981\uff0c\u4e0d\u540c\u7684\u6b8b\u7f3a\u65b9\u5f0f\u4f1a\u5bfc\u81f4\u4e0d\u540c\u7684\u884c\u4e3a\u3002"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'List<BookStore> stores = Arrays.asList(\n    BookStoreDraft.$.produce(store -> {\n        store\n            .setId(1L)\n            .setName("O\'REILLY+");\n            // No website here\n    }),\n    BookStoreDraft.$.produce(store -> {\n        store\n            .setId(2L)\n            .setName("MANNING+")\n            .setWebsite(null);\n            // Null website here\n    })\n);\nsqlClient\n    .getEntities()\n    .batchSaveCommand(stores)\n    .configure(it -> it.setMode(SaveMode.UPDATE_ONLY))\n    .execute();\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val stores = listOf(\n    new(BookStore::class).by {\n        id = 1L\n        name = "O\'REILLY+"\n        // No website here\n    },\n    new(BookStore::class).by {\n        id = 2L\n        name = "MANNING+"\n        website = null\n        // Null website here\n    }\n)\nsqlClient\n    .entities\n    .batchSave(stores) {\n        setMode(SaveMode.UPDATE_ONLY)\n    }\n')))),(0,l.kt)("p",null,"\u8fd9\u91cc\uff0c\u6211\u4eec\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"batchSaveCommand"),"\u65b9\u6cd5\u4fdd\u5b58\u4e24\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore"),"\u5bf9\u8c61\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7b2c1\u4e2a\u5bf9\u8c61\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"website"),"\u5c5e\u6027\u5e76\u672a\u88ab\u6307\u5b9a\uff0c\u5904\u4e8eUnloaded\u72b6\u6001\uff0c\u5373\u672a\u77e5\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7b2c2\u4e2a\u5bf9\u8c61\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"website"),"\u5c5e\u6027\u88ab\u660e\u786e\u6307\u5b9a\u4e3anull\u3002"))),(0,l.kt)("p",null,"\u751f\u6210\u7684\u4e24\u6761SQL\u5206\u522b\u662f"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fdd\u5b58",(0,l.kt)("inlineCode",{parentName:"p"},"website"),"\u5c5e\u6027\u6ca1\u6709\u88ab\u6307\u5b9a\u7684\u5bf9\u8c61"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK_STORE \n// highlight-next-line\nset NAME = ? \nwhere ID = ?\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fdd\u5b58",(0,l.kt)("inlineCode",{parentName:"p"},"website"),"\u5c5e\u6027\u88ab\u6307\u5b9a\u4e3anull\u7684\u5bf9\u8c61"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK_STORE \n// highlight-next-line\nset NAME = ?, WEBSITE = ? \nwhere ID = ?\n")))),(0,l.kt)("p",null,"\u6211\u4eec\u770b\u5230\uff0c\u4e24\u6761SQL\u5dee\u5f02\u5f88\u5927\u3002\u4e0d\u8bbe\u7f6e\u548c\u8bbe\u7f6e\u4e3anull\u5b8c\u5168\u662f\u4e24\u56de\u4e8b\u3002"),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u6b8b\u7f3a\u5bf9\u8c61\u5bf9\u4fdd\u5b58\u6307\u4ee4\u800c\u8a00\u975e\u5e38\u91cd\u8981\uff0csave\u6307\u4ee4\u7edd\u5927\u90e8\u5206\u529f\u80fd\u90fd\u662f\u7531\u5bf9\u8c61\u7684\u6b8b\u7f3a\u65b9\u5f0f\u7cbe\u7ec6\u63a7\u5236\u3002"),(0,l.kt)("p",{parentName:"admonition"},"\u4f9d\u9760\u5bf9\u8c61\u7684\u6b8b\u7f3a\u6027\u6765\u51b3\u5b9a\u5982\u4f55\u4fdd\u5b58\u4efb\u610f\u590d\u6742\u7684\u5bf9\u8c61\u6811\uff08\u540e\u6587\u4f1a\u8ba8\u8bba\u4fdd\u5b58\u5173\u8054\u548c\u5173\u8054\u5bf9\u8c61\u76f8\u5173\u7684\u77e5\u8bc6\uff09\uff0c\u800c\u975e\u4f9d\u8d56\u6570\u636e\u6a21\u578b\u4e0a\u9759\u6001\u7684\u7ea7\u8054\u4fdd\u5b58\u914d\u7f6e\uff0c\u662fjimmer-sql\u548c\u5176\u5b83ORM\u5728\u6570\u636e\u4fdd\u5b58\u8fd9\u65b9\u9762\u7684\u672c\u8d28\u533a\u522b\u3002")),(0,l.kt)("h2",{id:"\u4e50\u89c2\u9501"},"\u4e50\u89c2\u9501"),(0,l.kt)("p",null,"\u8981\u4f7f\u7528\u4e50\u89c2\u9501\uff0c\u5148\u8981\u5728\u5b9e\u4f53\u63a5\u53e3\u4e2d\u914d\u7f6e"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookStore.java"',title:'"BookStore.java"'},"@Entity\npublic interface BookStore {\n\n    @Version\n    int version();\n\n    ... omit other properties ...\n}\n"))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookStore.kt"',title:'"BookStore.kt"'},"@Entity\ninterface BookStore {\n\n    @Version\n    val version: Int\n\n    ... omit other properties ...\n}\n")))),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5bf9\u4e8einsert\u64cd\u4f5c\u800c\u8a00\uff08\u65e0\u8bba\u662f\u4eba\u4e3a\u6307\u5b9a\u8fd8\u662f\u81ea\u52a8\u5224\u5b9a\uff09\uff0c\u5141\u8bb8\u4e0d\u6307\u5b9a\u4e50\u89c2\u9501\u5b57\u6bb5\uff0c\u7cfb\u7edf\u4ee50\u4f5c\u4e3a\u5176\u9ed8\u8ba4\u503c\u3002\u5f53\u7136\uff0c\u5982\u679c\u5f00\u53d1\u4eba\u5458\u6307\u5b9a\u4e86\uff0c\u5c31\u7528\u5176\u6307\u5b9a\u7684\u503c\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5bf9\u4e8eupdate\u64cd\u4f5c\u800c\u8a00\uff08\u65e0\u8bba\u662f\u4eba\u4e3a\u6307\u5b9a\u8fd8\u662f\u81ea\u52a8\u5224\u5b9a\uff09\uff0c\u5fc5\u987b\u6307\u5b9a\u4e50\u89c2\u9501\u5b57\u6bb5\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u5f02\u5e38\u3002")))),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<BookStore> result = sqlClient\n    .getEntities()\n    .saveCommand(\n        BookStoreDraft.$.produce(store -> {\n            store\n                .setId(2)\n                .setWebsite("http://www.manning.com")\n                // highlight-next-line\n                .setVersion(0);\n        })\n    )\n    .configure(it -> it.setMode(SaveMode.UPDATE_ONLY))\n    .execute();\nSystem.out.println(\n    "Original entity: " + result.getOriginalEntity()\n);\nSystem.out.println(\n    "Modified entity: " + result.getModifiedEntity()\n);\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient\n    .entities\n    .save(\n        new(BookStore::class).by {\n            id = 2L\n            website = "http://www.manning.com"\n            // highlight-next-line\n            version = 0\n        }\n    ) {\n        setMode(SaveMode.UPDATE_ONLY) \n    }\nprintln(\n    "Original entity: " + result.originalEntity\n)\nprintln(\n    "Modified entity: " + result.modifiedEntity\n)\n')))),(0,l.kt)("p",null,"\u6700\u7ec8\u751f\u6210\u7684SQL\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK_STORE \nset \n    /* highlight-next-line */\n    VERSION = VERSION + 1 \nwhere \n    ID = ? \nand \n    /* highlight-next-line */\n    VERSION = ?\n")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u5982\u679c\u6b64SQL\u5f71\u54cd\u884c\u6570\u4e3a0\uff0c\u5c06\u4f1a\u5bfc\u81f4\u5f02\u5e38\uff0c\u5f02\u5e38\u7c7b\u578b\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"org.babyfish.jimmer.sql.OptimisticLockException"),"\u3002")),(0,l.kt)("p",null,"\u5982\u679c\u7248\u672c\u5339\u914d\uff0c\u6ca1\u6709\u53d1\u751f\u5f02\u5e38\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u8f93\u51fa\u4e3a\uff08\u539f\u8f93\u51fa\u662f\u7d27\u51d1\u7684\uff0c\u4e3a\u4e86\u65b9\u4fbf\u9605\u8bfb\uff0c\u8fd9\u91cc\u8fdb\u884c\u4e86\u683c\u5f0f\u5316\uff09:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'Original entity: {\n    "id":2,\n    "website":"http://www.manning.com",\n    "version":0\n}\nModified entity: {\n    "id":2,\n    "website":"http://www.manning.com",\n    /* highlight-next-line */\n    "version":1\n}\n')),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"result.modifiedEntity"),"\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"version"),"\u53d1\u751f\u4e86\u53d8\u5316\u3002"),(0,l.kt)("h2",{id:"\u4fdd\u5b58\u5173\u8054"},"\u4fdd\u5b58\u5173\u8054"),(0,l.kt)("p",null,"\u6211\u4eec\u8fd8\u53ef\u4ee5\u4e3a\u88ab\u4fdd\u5b58\u5bf9\u8c61\u6307\u5b9a\u5173\u8054\u5c5e\u6027\uff0c\u6709\u4e24\u79cd\u7528\u6cd5"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5173\u8054\u5bf9\u8c61\u4ec5\u5177\u5907id\u5c5e\u6027\uff1a\u8fd9\u8868\u793a\u4ec5\u4ec5\u4fdd\u5b58\u5173\u8054\u672c\u8eab\uff0c\u5982\u5916\u952e\uff0c\u4e2d\u95f4\u8868\u8868\u8bb0\u5f55\uff1b\u4f46\u4e0d\u4f1a\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5173\u8054\u5bf9\u8c61\u5177\u5907\u975eid\u5c5e\u6027\uff1a\u8fd9\u8868\u793a\u4e0d\u4ec5\u4fdd\u5b58\u5173\u8054\u672c\u8eab\uff0c\u8fd8\u4f1a\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61\u3002"))),(0,l.kt)("p",null,"\u672c\u8282\u91cd\u70b9\u8ba8\u8bba\u7b2c\u4e00\u79cd\u7528\u6cd5\uff0c\u4ec5\u4fdd\u5b58\u5173\u8054\u672c\u8eab\uff1b\u7b2c\u4e8c\u79cd\u7528\u6cd5\u4f1a\u5728\u4e0b\u4e00\u8282\u8bb2\u8ff0\u3002"),(0,l.kt)("h3",{id:"\u57fa\u672c\u7528\u6cd5"},"\u57fa\u672c\u7528\u6cd5"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<Book> result = sqlClient\n    .getEntities()\n    .save(\n        BookDraft.$.produce(book -> {\n            book\n                .setName("SpringBoot in Action")\n                .setEdition(1)\n                .setPrice(new BigDecimal("44.99"))\n                // highlight-next-line\n                .applyStore(store -> \n                    store.setId(2L)\n                )\n                // highlight-next-line\n                .addIntoAuthors(author -> \n                    author.setId(2L)\n                )\n                // highlight-next-line\n                .addIntoAuthors(author -> \n                    author.setId(3L)\n                );\n        })\n    );\nSystem.out.println("Affected row counts");\nSystem.out.println(\n    "\\ttotal: " + result.getTotalAffectedRowCount()\n);\nSystem.out.println(\n    "\\tBOOK: " +\n        result.getAffectedRowCount(\n            AffectedTable.of(Book.class)\n        )\n);\nSystem.out.println(\n    "\\tBOOK_AUTHOR_MAPPING: " +\n        result.getAffectedRowCount(\n            AffectedTable.of(BookProps.AUTHORS)\n        )\n);\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient\n    .entities\n    .save(\n        new(Book::class).by {\n            name = "SpringBoot in Action"\n            edition = 1\n            price = BigDecimal("44.99")\n            // highlight-next-line\n            store().apply {\n                id = 2L\n            }\n            // highlight-next-line\n            authors().addBy { \n                id = 2L\n            }\n            // highlight-next-line\n            authors().addBy { \n                id = 3L\n            }\n        }\n    )\nprintln("Affected row counts")\nprintln(\n    "\\ttotal: ${result.totalAffectedRowCount}"\n)\nprintln(\n    "\\tBOOK: ${result.affectedRowCount(Book::class)}"\n)\nprintln(\n    "\\tBOOK_AUTHOR_MAPPING: ${\n        result.affectedRowCount(Book::authors)\n    }"\n)\n')))),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"\u8fd9\u91cc\uff0c\u7528\u6237\u4f20\u9012\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\u5177\u5907\u591a\u5bf9\u4e00\u5c5e\u6027",(0,l.kt)("inlineCode",{parentName:"p"},"store"),"\u548c\u591a\u5bf9\u591a\u5c5e\u6027",(0,l.kt)("inlineCode",{parentName:"p"},"authors"),"\uff0c\u4f46\u662f\u6240\u6709\u5173\u8054\u5bf9\u8c61\u90fd\u53ea\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"id"),"\u5c5e\u6027\u3002"),(0,l.kt)("p",{parentName:"admonition"},"\u8fd9\u6837\u7684\u7528\u6cd5\u8868\u793a\u53ea\u4fdd\u5b58\u5173\u8054\u672c\u8eab\uff0c\u5f53\u524d\u8868\u7684\u5916\u952e",(0,l.kt)("inlineCode",{parentName:"p"},"STORE_ID"),"\u6709\u53ef\u80fd\u88ab\u4fee\u6539\uff0c\u5f53\u524d\u8868\u548c\u5173\u8054\u5bf9\u8c61\u4e4b\u95f4\u7684\u4e2d\u95f4\u8868",(0,l.kt)("inlineCode",{parentName:"p"},"BOOK_AUTHOR_MAPPING"),"\u53ef\u80fd\u88ab\u4fee\u6539\uff0c\u4f46\u662f\u5173\u8054\u5bf9\u8c61\u6240\u6620\u5c04\u7684\u8868",(0,l.kt)("inlineCode",{parentName:"p"},"BOOK_STORE"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"AUTHOR"),"\u4e0d\u4f1a\u88ab\u4fee\u6539\u3002"),(0,l.kt)("p",{parentName:"admonition"},"\u5bf9\u8fd9\u79cd\u7528\u6cd5\u800c\u8a00\uff0c\u7528\u6237\u5fc5\u987b\u4fdd\u8bc1\u6240\u6709\u7684\u5173\u8054\u5bf9\u8c61\u7684id\u90fd\u5fc5\u987b\u80fd\u5728\u6570\u636e\u5e93\u4e2d\u67e5\u5230\u5bf9\u8c61\uff1b\u5426\u5219\uff0c\u6570\u636e\u5e93\u4f1a\u56e0\u8fdd\u80cc\u5f15\u7528\u5b8c\u6574\u6027\u800c\u62a5\u9519\u3002\u5373\uff0c\u4e0d\u63a5\u53d7\u975e\u6cd5\u7684\u5173\u8054\u5bf9\u8c61id\u3002")),(0,l.kt)("p",null,"\u751f\u6210\u7684SQL\u5982\u4e0b"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5224\u65ad\u8981\u4fdd\u5b58\u7684\u4e66\u7c4d\u662f\u5426\u5df2\u7ecf\u5b58\u5728"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION \nfrom BOOK as tb_1_ \nwhere tb_1_.NAME = ? and tb_1_.EDITION = ?\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5206\u4e24\u79cd\u60c5\u51b5"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u5982\u679c\u4e0a\u4e00\u6b65\u5224\u65ad\u7ed3\u679c\u4e3a\u4e0d\u5b58\u5728\uff0c\u5219\u63d2\u5165\u6570\u636e",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK(ID, NAME, EDITION, PRICE, STORE_ID) \nvalues(?, ?, ?, ?, ?)\n"))),(0,l.kt)("li",{parentName:"ol"},"\u5982\u679c\u4e0a\u4e00\u6b65\u5224\u65ad\u7ed3\u679c\u4e3a\u5b58\u5728\uff0c\u5219\u4fee\u6539\u6570\u636e",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK \nset PRICE = ?, STORE_ID = ? \nwhere ID = ?\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u4e0a\u4e00\u6b65\u6267\u884c\u4e86insert\u64cd\u4f5c\uff0c\u5219\u4e0d\u505a\u4efb\u4f55\u5224\u65ad\uff0c\u4e3a\u5173\u8054\u5c5e\u6027",(0,l.kt)("inlineCode",{parentName:"p"},"Book.authors"),"\u7684\u4e2d\u95f4\u8868",(0,l.kt)("inlineCode",{parentName:"p"},"BOOK_AUTHOR_MAPPING"),"\u63d2\u5165\u6570\u636e"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK_AUTHOR_MAPPING(BOOK_ID, AUTHOR_ID) \nvalues (?, ?), (?, ?)\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u5728\u4e0a\u4e00\u6b65\u4e2d\u8fdb\u884c\u4e86\u66f4\u65b0\u64cd\u4f5c"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5148\u5728\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u5f53\u524d",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\u5b58\u5728\u54ea\u4e9b\u5173\u8054\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Author"),"\u5bf9\u8c61"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select AUTHOR_ID \nfrom BOOK_AUTHOR_MAPPING \nwhere BOOK_ID = ?\n")),(0,l.kt)("p",{parentName:"li"},"\u5c06\u8fd9\u6761SQL\u8bed\u53e5\u80fd\u67e5\u5230\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Author"),"\u5bf9\u8c61\u7684id\u7684\u96c6\u5408\u79f0\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"listDb"),"\uff0c\u5c06\u7528\u6237\u6570\u636e\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\u5bf9\u5e94\u7684\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Author"),"\u5173\u8054\u5bf9\u8c61\u7684id\u5f62\u6210\u7684\u96c6\u5408\u79f0\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"listUser"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4ee4",(0,l.kt)("inlineCode",{parentName:"p"},"listDiff1")," = ",(0,l.kt)("inlineCode",{parentName:"p"},"listDb")," - ",(0,l.kt)("inlineCode",{parentName:"p"},"listUser"),"\uff0c\u5373\u6570\u636e\u5e93\u4e2d\u5b58\u5728\uff0c\u4f46\u7528\u6237\u53c2\u6570\u4e2d\u4e0d\u5b58\u5728\u7684Author\u5bf9\u8c61id\u96c6\u5408\u3002"),(0,l.kt)("p",{parentName:"li"},"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"listDiff1"),"\u957f\u5ea6\u975e0\uff0c\u5219\u6267\u884c\u5982\u4e0bSQL\u5220\u9664\u4e0d\u9700\u8981\u7684\u5173\u8054\uff08\u5047\u8bbe",(0,l.kt)("inlineCode",{parentName:"p"},"listDiff1"),"\u957f\u5ea6\u4e3a3\uff09\uff1a"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"delete from \nBOOK_AUTHOR_MAPPING \nwhere (BOOK_ID, AUTHOR_ID) in (\n    (?, ?), \n    (?, ?),\n    (?, ?)\n)\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4ee4",(0,l.kt)("inlineCode",{parentName:"p"},"listDiff2")," = ",(0,l.kt)("inlineCode",{parentName:"p"},"listUser")," - ",(0,l.kt)("inlineCode",{parentName:"p"},"listDb"),"\uff0c\u5373\u7528\u6237\u53c2\u6570\u4e2d\u5b58\u5728\uff0c\u4f46\u6570\u636e\u5e93\u4e2d\u4e0d\u5b58\u5728\u7684Author\u5bf9\u8c61id\u96c6\u5408\u3002"),(0,l.kt)("p",{parentName:"li"},"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"listDiff2"),"\u957f\u5ea6\u975e0\uff0c\u5219\u6267\u884c\u5982\u4e0bSQL\u63d2\u5165\u7f3a\u5931\u7684\u5173\u8054\uff08\u5047\u8bbe",(0,l.kt)("inlineCode",{parentName:"p"},"listDiff2"),"\u957f\u5ea6\u4e3a2\uff09\uff1a"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK_AUTHOR_MAPPING(BOOK_ID, AUTHOR_ID) \nvalues (?, ?), (?, ?)\n")))))))),(0,l.kt)("p",null,"\u4e0a\u8ff0Java\u4ee3\u7801\u7684\u6253\u5370\u7ed3\u679c\u53d7\u6570\u636e\u5e93\u4e2d\u5df2\u6709\u6570\u636e\u7684\u5f71\u54cd\uff0c\u4e0d\u540c\u7684\u60c5\u51b5\u6709\u4e0d\u540c\u7684\u6253\u5370\u7ed3\u679c\u3002"),(0,l.kt)("p",null,"\u5047\u8bbe\u9664\u4e86insert\u64cd\u4f5c\u5916\uff0c\u6ca1\u6709\u5176\u4ed6\u4fee\u6539\u64cd\u4f5c\u88ab\u6267\u884c\uff0c\u6253\u5370\u7ed3\u679c\u5e94\u8be5\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Affected row counts\n    total: 3\n    BOOK: 1\n    BOOK_AUTHOR_MAPPING: 2\n")),(0,l.kt)("h3",{id:"\u88ab\u7236\u5bf9\u8c61\u629b\u5f03"},"\u88ab\u7236\u5bf9\u8c61\u629b\u5f03"),(0,l.kt)("p",null,"\u4ece\u4e0a\u9762\u7684\u8bba\u8ff0\u53ef\u4ee5\u770b\u5230\uff0csave\u6307\u4ee4\u6709\u53ef\u80fd\u5bfc\u81f4\u591a\u5bf9\u591a\u5173\u8054\u4e2d\u95f4\u8868\u7684\u6570\u636e\u7684\u88ab\u5220\u9664\uff0c\u8fd9\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u60c5\u51b5\u3002"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u76f4\u63a5\u57fa\u4e8e\u5916\u952e\u7684\u4e00\u5bf9\u4e00\u6216\u4e00\u5bf9\u591a\u5173\u8054\u800c\u8a00\uff0c\u9700\u8981\u5904\u7406\u7684\u60c5\u51b5\u66f4\u590d\u6742\u4e00\u4e9b\u3002"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'Long bookId1 = ...;\nLong bookId2 = ...;\nsqlClient\n    .getEntities()\n    .save(\n        BookStoreDraft.$.produce(store -> {\n            store\n                .setName("TURING")\n                .addIntoBooks(\n                    book -> book.setId(bookId1)\n                )\n                .addIntoBooks(\n                    book -> book.setId(bookId2)\n                );\n        })\n    );\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val bookId1 = ...\nval bookId2 = ...\nsqlClient\n    .entities\n    .save(\n        new(BookStore::class).by { \n            name = "TURING"\n            books().addBy { \n                id = bookId1\n            }\n            books().addBy { \n                id = bookId2\n            }\n        }\n    )\n')))),(0,l.kt)("p",null,"\u8fd9\u6bb5\u4ee3\u7801\u4fdd\u5b58\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore"),"\u5bf9\u8c61\uff0c\u5176\u4e00\u5bf9\u591a\u5c5e\u6027",(0,l.kt)("inlineCode",{parentName:"p"},"books"),"\u5177\u5907\u4e24\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"book1"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"book2"),"\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u7ecf\u5224\u5b9a",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore"),"\u5e94\u8be5\u88abinsert\uff0c\u5219\u4e00\u5207\u7b80\u5355\uff1b\u4f46\u65f6\uff0c\u5982\u679c\u7ecf\u5224\u5b9a",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore"),"\u5e94\u8be5\u88abupdate\uff0c\u5c31\u76f8\u5bf9\u590d\u6742\u4e86\u3002"),(0,l.kt)("p",null,"\u5047\u8bbe\u73b0\u5728\u6570\u636e\u5e93\u4e2d\u5bf9\u5e94\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore"),"\u5bf9\u8c61\u7684\u4e00\u5bf9\u591a\u5173\u8054\u5c5e\u6027",(0,l.kt)("inlineCode",{parentName:"p"},"books"),"\u5177\u59074\u4e2a\u5bf9\u8c61: ",(0,l.kt)("inlineCode",{parentName:"p"},"book2"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"book3"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"book4"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"book5"),"\u3002"),(0,l.kt)("p",null,"\u5f88\u660e\u663e\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"book3"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"book4"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"book5"),"\u88ab\u65b0\u7684\u5173\u8054\u629b\u5f03\u4e86\u3002\u4f46\u662f\u4e00\u5bf9\u591a\u5173\u8054",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore.books"),"\u4e0d\u662f\u57fa\u4e8e\u4e2d\u95f4\u8868\u7684\u6620\u5c04\uff0c\u800c\u662f\u57fa\u4e8e\u5916\u952e\u6620\u5c04\u3002jimmer-sql\u5c06\u5982\u4f55\u629b\u5f03",(0,l.kt)("inlineCode",{parentName:"p"},"book3"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"book4"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"book5"),"\u5462\uff1f"),(0,l.kt)("p",null,"\u548cJPA\u4e0d\u540c\uff0cjimmer-sql\u7684\u4e0d\u5141\u8bb8\u76f4\u63a5\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"@OneToOne"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"@OneToMany"),"\u8fdb\u884c\u5173\u8054\u6620\u5c04\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"@OneToOne"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"@OneToMany"),"\u5fc5\u987b\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"mappedBy"),"\u5c5e\u6027\u3002\u53ef\u4ee5\u53c2\u8003",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#onetomany"},"@OneToMany"),"\u4ee5\u4e86\u89e3\u66f4\u591a\u3002"),(0,l.kt)("p",null,"\u8fd9\u8868\u793a\uff0c\u901a\u8fc7\u4e00\u5bf9\u591a\u5173\u8054",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore.books"),"\u4e00\u5b9a\u80fd\u627e\u5230\u4e0e\u4e4b\u5bf9\u5e94\u7684\u591a\u5bf9\u4e00\u5173\u8054",(0,l.kt)("inlineCode",{parentName:"p"},"Book.store"),"\u3002"),(0,l.kt)("p",null,"\u63a5\u4e0b\u6765\uff0cjimmer-sql\u4f1a\u53c2\u8003\u591a\u5bf9\u4e00\u5173\u8054\u5c5e\u6027",(0,l.kt)("inlineCode",{parentName:"p"},"Book.store"),"\u4e0a\u7684",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#ondissociate"},"@OnDissociate"),"\u6ce8\u89e3\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"Book.store"),"\u6240\u5bf9\u5e94\u7684\u5916\u952e\u88ab",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#ondissociate"},"@OnDissociate"),"\u6ce8\u89e3\u914d\u7f6e\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"SET_NULL"),"\uff0c\u5219\uff0c\u6267\u884c\u5982\u4e0bSQL"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK \nset STORE_ID = null \nwhere \n    STORE_ID = ? \nand \n    /* highlight-next-line */\n    ID not in(?, ?)\n")),(0,l.kt)("p",{parentName:"li"},"\u5176\u4e2d\u53c2\u6570\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"bookId1"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"bookId2"),"\u3002\u7ecf",(0,l.kt)("inlineCode",{parentName:"p"},"not in"),"\u8bed\u53e5\u7b5b\u67e5\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"book3"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"book4"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"book5"),"\u8fd9\u4e9b\u88ab\u629b\u5f03\u5bf9\u8c61\u7684\u5916\u952e\u5c31\u88ab\u8bbe\u7f6e\u4e3anull\u4e86\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5426\u5219\uff0c\u5219\u5148\u6267\u884c"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select ID \nfrom BOOK \nwhere \n    STORE_ID = ? \nand \n    /* highlight-next-line */\n    ID not in(?, ?)\n")),(0,l.kt)("p",{parentName:"li"},"\u5176\u4e2d\u53c2\u6570\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"bookId1"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"bookId2"),"\u3002\u7ecf",(0,l.kt)("inlineCode",{parentName:"p"},"not in"),"\u8bed\u53e5\u7b5b\u67e5\uff0c\u5c31\u5f97\u5230\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"book3"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"book4"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"book5"),"\u8fd9\u4e9b\u88ab\u629b\u5f03\u5bf9\u8c61\u7684id\u4e86\u3002"),(0,l.kt)("blockquote",{parentName:"li"},(0,l.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u67e5\u8be2\u6ca1\u6709\u8fd4\u56de\u4efb\u4f55\u6570\u636e\uff0c\u5c31\u5ffd\u7565\u540e\u7eed\u6b65\u9aa4\u3002")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"Book.store"),"\u6240\u5bf9\u5e94\u7684\u5916\u952e\u88ab",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#ondissociate"},"@OnDissociate"),"\u6ce8\u89e3\u914d\u7f6e\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"DELETE"),"\uff0c\n\u4f7f\u7528",(0,l.kt)("a",{parentName:"p",href:"./delete-command"},"delete\u6307\u4ee4"),"\u5220\u9664\u8fd9\u4e9b\u88ab\u629b\u5f03\u5bf9\u8c61\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5426\u5219\uff0c\u629b\u51fa\u5f02\u5e38"))))),(0,l.kt)("p",null,"\u4e0a\u9762\u6240\u8ba8\u8bba\u7684\u8fd9\u4e9b\u60c5\u51b5\uff0c\u90fd\u9700\u8981\u5f00\u53d1\u4eba\u5458\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"Book.store"),"\u5c5e\u6027\u4e0a\u4f7f\u7528\u6ce8\u89e3",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#ondissociate"},"@OnDissociate"),"\u3002"),(0,l.kt)("p",null,"\u7136\u800c\uff0c\u4f60\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u4f7f\u7528",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#ondissociate"},"@OnDissociate"),"\u6ce8\u89e3\uff0c\u800c\u52a8\u6001\u5730\u4e3asave\u6307\u4ee4\u6307\u5b9adissociateAction\u914d\u7f6e\u3002"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'UUID bookId1 = ...;\nUUID bookId2 = ...;\nsqlClient\n    .getEntities()\n    .saveCommand(\n        BookStoreDraft.$.produce(store -> {\n            store\n                .setName("TURING")\n                .addIntoBooks(\n                    book -> book.setId(bookId1)\n                )\n                .addIntoBooks(\n                    book -> book.setId(bookId2)\n                );\n        })\n    )\n    .configure(it -> \n        // highlight-next-line\n        it.setDissociateAction(\n            BookProps.STORE,\n            DissociateAction.DELETE\n        )\n    )\n    .execute();\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val bookId1 = ...\nval bookId2 = ...\nsqlClient\n    .entities\n    .save(\n        new(BookStore::class).by { \n            name = "TURING"\n            books().addBy { \n                id = bookId1\n            }\n            books().addBy { \n                id = bookId2\n            }\n        }\n    ) {\n        // highlight-next-line\n        setDissociateAction(Book::store, DissociateAction.DELETE)\n    }\n')))),(0,l.kt)("p",null,"\u8fd9\u91cc\uff0c\u52a8\u6001\u5730\u8c03\u7528\u6307\u4ee4\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"setDissociateAction"),"\u65b9\u6cd5\uff0c\u76f8\u6bd4\u4e8e\u9759\u6001\u5730\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"Book.store"),"\u5c5e\u6027\u4e0a\u4f7f\u7528\u6ce8\u89e3",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#ondissociate"},"@OnDissociate"),"\u5e76\u6307\u5b9a\u7ea7\u8054\u5220\u9664\uff0c\u6548\u679c\u5b8c\u5168\u4e00\u6837\u3002"),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("ol",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"setDissociateAction"),"\u65b9\u6cd5\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"DissociateAction.SET_NULL"),"\uff0c\u5219\u88ab\u8bbe\u7f6e\u5173\u8054\u5c5e\u6027\u5fc5\u987b\u53ef\u7a7a\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u5f02\u5e38\u3002")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u65e2\u52a8\u6001\u5730\u4e3asave\u6307\u4ee4\u914d\u7f6e\u4e86\u5220\u9664\u89c4\u5219\uff0c\u53c8\u9759\u6001\u5730\u5728\u5b9e\u4f53\u63a5\u53e3\u4e2d\u901a\u8fc7\u6ce8\u89e3",(0,l.kt)("a",{parentName:"p",href:"../basic/mapping#ondissociate"},"@OnDissociate"),"\u914d\u7f6e\u4e86\u5220\u9664\u89c4\u5219\uff0c\u5219\u52a8\u6001\u914d\u7f6e\u4f18\u5148\u3002")))),(0,l.kt)("h2",{id:"\u4fdd\u5b58\u5173\u8054\u548c\u5173\u8054\u5bf9\u8c61"},"\u4fdd\u5b58\u5173\u8054\u548c\u5173\u8054\u5bf9\u8c61"),(0,l.kt)("p",null,"\u4e0a\u4e00\u8282\u8ba8\u8bba\u7684\u5185\u5bb9\u4e2d\uff0c\u6211\u4eec\u7684\u4f8b\u5b50\u8ba9\u5173\u8054\u5bf9\u8c61\u4ec5\u4ec5\u5177\u5907id\u5c5e\u6027\uff0c\u8fd9\u6837\uff0csave\u6307\u4ee4\u5c31\u53ea\u4fee\u6539\u5173\u8054\uff0c\u800c\u4e0d\u4fee\u6539\u5173\u8054\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u5173\u8054\u5bf9\u8c61\u5177\u5907id\u4ee5\u5916\u7684\u5c5e\u6027\uff0c\u5982\u4e0b"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'sqlClient\n    .getEntities()\n    .saveCommand(\n        BookDraft.$.produce(book ->\n            book\n                .setName("SpringBoot in Action")\n                .setEdition(1)\n                .setPrice(new BigDecimal("44.99"))\n                .applyStore(store ->\n                    store\n                        .setName("MANNING")\n                        .setWebsite("http://www.manning.com")\n                        .setVersion(0)\n                )\n                .addIntoAuthors(author ->\n                    author\n                        .setFirstName("Craig")\n                        .setLastName("Walls")\n                        .setGender(Gender.MALE)\n                )\n        )\n    )\n    // highlight-next-line\n    .configure(it -> it.setAutoAttachingAll())\n    .execute();\n'))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'sqlClient\n    .entities\n    .save(\n        new(Book::class).by { \n            name = "SpringBoot in Action"\n            edition = 1\n            price = BigDecimal("44.99")\n            store().apply { \n                name = "MANNING"\n                website = "http://www.manning.com"\n                version = 0\n            }\n            authors().addBy {\n                firstName = "Craig"\n                lastName = "Walls"\n                gender = Gender.MALE\n            }\n        }\n    ) {\n        // highlight-next-line\n        setAutoAttachingAll()\n    }\n')))),(0,l.kt)("p",null,"\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u751f\u6210\u7684SQL\u968f\u7740\u6570\u636e\u5e93\u7684\u72b6\u6001\u4e0d\u540c\u800c\u4e0d\u540c\u3002\u5982\u679c\u7f57\u5217\u5404\u79cd\u53ef\u80fd\u6027\uff0c\u5c06\u5bfc\u81f4\u4ee5\u67af\u71e5\u7684\u5185\u5bb9\u8017\u53bb\u672c\u6587\u6863\u5927\u91cf\u7bc7\u5e45\u3002\u56e0\u6b64\u8fd9\u91cc\u4ec5\u4f5c\u6587\u5b57\u8ba8\u8bba\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u7531\u4e8e\u53ef\u4ee5\u4e3a\u5173\u8054\u5bf9\u8c61\u6307\u5b9a\u4efb\u4f55\u5c5e\u6027\uff0c\u5f53\u7136\u4e5f\u5305\u542b\u5173\u8054\u5bf9\u8c61\u7684\u5173\u8054\u5c5e\u6027\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4e0d\u65ad\u5d4c\u5957\uff0c\u5f62\u6210\u4e00\u9897\u4efb\u610f\u6df1\u5ea6\u7684\u5bf9\u8c61\u6811\uff08\u4e3a\u4e86\u7bc7\u5e45\uff0c\u672c\u4f8b\u4e2d\u5e76\u6ca1\u6709\u5c55\u793a\u6df1\u5ea6\u5d4c\u5957\uff09")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u9664",(0,l.kt)("a",{parentName:"p",href:"#%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%BC%8F"},"\u4fdd\u5b58\u6a21\u5f0f"),"\u5916\uff0c\u672c\u8282\u524d\u6240\u8bb2\u7684\u77e5\u8bc6\u5bf9\u6b64\u7528\u4f8b\u5b50\u5747\u6709\u6548\u3002\u6240\u6709\u529f\u80fd\u53ef\u4ee5\u9012\u5f52\u5730\u5e94\u7528\u5230\u6240\u6709\u5c42\u7ea7\u3002"))),(0,l.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u91cd\u70b9\u8ba8\u8bba\u4e0a\u9762\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"setAutoAttachingAll()"),"\u3002"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u6839\u5bf9\u8c61\u800c\u8a00\uff0c\u7531\u5f00\u53d1\u4eba\u5458\u63a7\u5236\u4fdd\u5b58\u6a21\u5f0f\uff0c\u53ef\u4ee5\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"UPSERT"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"INSERT_ONLY"),"\u6216",(0,l.kt)("inlineCode",{parentName:"p"},"UPDATE_ONLY"),"\u3002\u5176\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"UPSERT"),"\u662f\u9ed8\u8ba4\u884c\u4e3a\u3002"),(0,l.kt)("p",null,"\u5173\u8054\u5bf9\u8c61\u7565\u6709\u4e0d\u540c\uff0c\u65e2\u4e0d\u53d7\u4fdd\u5b58\u6a21\u5f0fAPI\u63a7\u5236\uff0c\u4e5f\u4e0d\u652f\u6301INSERT_ONLY\uff0c\u4e14\u9ed8\u8ba4\u7684\u884c\u4e3a\u662fUPDATE_ONLY\u3002\u5373\uff0c\u5982\u679c\u6307\u5b9a\u7684\u5173\u8054\u5bf9\u8c61\u5728\u6570\u636e\u5e93\u4e2d\u4e0d\u5b58\u5728\uff0c\u5c06\u4f1a\u5bfc\u81f4\u5f02\u5e38\u3002"),(0,l.kt)("p",null,"\u8fd9\u6837\u7684\u9ed8\u8ba4\u9650\u5236\u662f\u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u9632\u6b62\u7528\u6237\u4e71\u6307\u5b9a\u6839\u672c\u4e0d\u5b58\u5728\u7684\u5173\u8054\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u7136\u800c\uff0c\u6709\u65f6\u7528\u6237\u7684\u786e\u60f3\u6307\u5b9a\u4e0d\u5b58\u5728\u7684\u5173\u8054\u5bf9\u8c61\uff0c\u5e76\u5207\u671f\u671b\u7cfb\u7edf\u81ea\u52a8\u63d2\u5165\u8fd9\u4e9b\u4e0d\u5b58\u5728\u7684\u5173\u8054\u5bf9\u8c61\u3002\u8fd9\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u8fd9\u4e48\u505a"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient\n    .getEntities()\n    .saveCommand(\n        ...object tree of arbitrary complexity, slightly...\n    )\n    .configure(it -> \n        it\n            // highlight-next-line\n            .setAutoAttaching(BookProps.STORE)\n            // highlight-next-line\n            .setAutoAttaching(BookProps.AUTHORS)\n    )\n    .execute();\n"))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient\n    .entities\n    .save(\n        ...object tree of arbitrary complexity, slightly...\n    ) {\n        // highlight-next-line\n        setAutoAttaching(Book::store)\n        // highlight-next-line\n        setAutoAttaching(Book::authors)\n    }\n")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7b2c1\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"setAutoAttaching"),"\u8868\u793a\uff1a\u5982\u679c\u5f53\u524d",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"store"),"\u5c5e\u6027\u6240\u5173\u8054\u7684\u5bf9\u8c61\u4e0d\u5b58\u5728\uff0c\u81ea\u52a8\u63d2\u5165\u5b83\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7b2c2\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"setAutoAttaching"),"\u8868\u793a\uff1a\u5982\u679c\u5f53\u524d",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"authors"),"\u5c5e\u6027\u6240\u5173\u8054\u7684\u96c6\u5408\u4e2d\u67d0\u4e9b\u5bf9\u8c61\u4e0d\u5b58\u5728\uff0c\u81ea\u52a8\u63d2\u5165\u5b83\u4eec\u3002"))),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"\u8fd9\u91cc\u6240\u8bf4\u7684\u5f53\u524d",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\uff0c\u5e76\u975e\u6839\u5bf9\u8c61\uff0c\u800c\u662f\u4efb\u610f\u5c42\u7ea7\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Book"),"\u5bf9\u8c61\u3002")),(0,l.kt)("p",null,"\u6216\u8bb8\uff0c\u8fd9\u6837\u6839\u636e\u5173\u8054\u4e00\u4e2a\u4e00\u4e2a\u914d\u7f6eauto attaching\u884c\u4e3a\u5f88\u7e41\u7410\u3002\u6240\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u66f4\u76f2\u76ee\u4e5f\u66f4\u4fbf\u6377\u7684\u7684API\uff0c\u5f00\u542f\u4efb\u4f55\u5173\u8054\u7684auto attaching\u3002"),(0,l.kt)("p",null,"\u8fd9\u5c31\u662f\u4e0a\u6587\u7684"),(0,l.kt)(o.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient\n    .getEntities()\n    .saveCommand(\n        ...object tree of arbitrary complexity, slightly...\n    )\n    .configure(it -> it.setAutoAttachingAll())\n    .execute()\n"))),(0,l.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"\nsqlClient\n    .entities\n    .save(\n        ...object tree of arbitrary complexity, slightly...\n    ) {\n        setAutoAttachingAll()\n    }\n\n")))),(0,l.kt)("p",null,"\u4f60\u53ef\u4ee5\u5982\u6b64\u7406\u89e3\uff0c\u8fd9\u6837\u914d\u7f6e\u540e\uff0c\u4efb\u4f55\u5173\u8054\u5bf9\u8c61\u7684\u4fdd\u5b58\u6a21\u5f0f\u90fd\u53d8\u6210\u4e86UPSERT\u3002"),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u6ce8\uff1a\u5373\u4fbf\u914d\u7f6e\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"AutoAttaching"),"\uff0c\u4e5f\u53ea\u5bf9\u5177\u5907\u975eid\u5c5e\u6027\u7684\u5173\u8054\u5bf9\u8c61\u6709\u6548\u3002\u53ea\u6709id\u5c5e\u6027\u7684\u5173\u8054\u5bf9\u8c61\u4ecd\u7136\u4e0d\u4f1a\u6309\u9700\u81ea\u52a8\u63d2\u5165\u3002")))}N.isMDXComponent=!0},46607:function(e,n,t){n.Z=t.p+"assets/images/save-6631bb52e10864ffe98320a913473282.png"}}]);